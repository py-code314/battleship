(()=>{"use strict";class t{#t;constructor(t,e,s){this.id=crypto.randomUUID(),this.length=t,this.#t=0,this.sunk=!1,this.position=[],this.direction=e,this.name=s,this.sunkNotified=!1}setPosition(t){this.position=t}getPosition(){return[...this.position]}setDirection(t){this.direction=t}getDirection(){return this.direction}getSunkNotified(){return this.sunkNotified}setSunkNotified(t){this.sunkNotified=t}hit(){this.#t<this.length&&this.#t++,this.isSunk()}isSunk(){return this.#t>=this.length&&(this.sunk=!0),this.sunk}}class e{constructor(t=10,e=10){this.rows=t,this.columns=e,this.board=this.createBoard(),this.ships=[],this.emptyCells=[],this.allHits=new Set,this.shipCells=new Set}getShips(){return[...this.ships]}setShips(t){this.ships.push(t)}getAllHits(){return this.allHits}getShipCells(){return this.shipCells}addShipCell(t){this.shipCells.add(`${t}`)}createBoard(){const t=[];for(let e=0;e<this.rows;e++){const s=[];for(let t=0;t<this.columns;t++)s.push({row:e,column:t,isOccupied:!1,ship:null,isHit:!1,isReserved:!1});t.push(s)}return t}placeShip(t,e){const[s,i]=e;if(s<0||s>=this.rows||i<0||i>=this.columns||t.length<=0)return!1;const o="horizontal"===t.getDirection();if(o&&i+t.length>this.columns||!o&&s+t.length>this.rows)return!1;for(let e=0;e<t.length;e++){const t=o?this.board[s][i+e]:this.board[s+e][i];if(t.isOccupied||t.isReserved)return!1}for(let e=0;e<t.length;e++){const n=o?this.board[s][i+e]:this.board[s+e][i];n.ship=t,this.addShipCell([s+(o?0:e),i+(o?e:0)]),n.isOccupied=!0}return t.setPosition(e),t.setDirection(t.direction),this.ships.includes(t)||this.setShips(t),this.reserveCells(t,e),!0}reserveCells(t,e){const[s,i]=e,o=t.getDirection();for(let e=0;e<t.length;e++){const t="horizontal"===o?s:s+e,n="horizontal"===o?i+e:i;for(let e=-1;e<=1;e++)for(let s=-1;s<=1;s++){const i=t+e,o=n+s;if(i>=0&&i<this.rows&&o>=0&&o<this.columns){const t=this.board[i][o];t.isOccupied||(t.isReserved=!0)}}}}clearShipAndReservedCells(t){const[e,s]=t.getPosition(),i=t.getDirection();for(let o=0;o<t.length;o++){const t="horizontal"===i?e:e+o,n="horizontal"===i?s+o:s;for(let e=-1;e<=1;e++)for(let s=-1;s<=1;s++){const i=t+e,o=n+s;if(i>=0&&i<this.rows&&o>=0&&o<this.columns){this.board[i][o].isReserved=!1}}this.board[t][n].isOccupied=!1,this.board[t][n].ship=null}}canMoveTo(t,e){const[s,i]=e,{length:o,direction:n}=t;if("horizontal"===n&&i+o>this.columns||"vertical"===n&&s+o>this.rows)return!1;for(let e=0;e<o;e++){const o="horizontal"===n?s:s+e,a="horizontal"===n?i+e:i;for(let e=-1;e<=1;e++)for(let s=-1;s<=1;s++){const i=o+e,n=a+s;if(i>=0&&i<this.rows&&n>=0&&n<this.columns){const e=this.board[i][n];if(e.isOccupied&&e.ship!==t)return!1}}}return!0}receiveAttack(t){const[e,s]=t,i=this.board[e][s];if(i.isHit)throw new Error("This square has already been hit");return i.isHit=!0,this.allHits.add(`${e},${s}`),i.ship?(i.ship.hit(),!0):(this.emptyCells.push(t),!1)}resetBoard(){this.board.forEach((t=>t.forEach((t=>{t.isHit=!1,t.isOccupied=!1,t.ship=null,t.isReserved=!1})))),this.ships=[],this.emptyCells=[],this.allHits=new Set,this.shipCells=new Set}allShipsSunk(){return this.ships.every((t=>t.isSunk()))}}class s{constructor(t){this.type=t,this.gameBoard=new e,this.name="human"===t?"Human":"Computer"}makeMove(t,e){return t.receiveAttack(e)}isLost(){return this.gameBoard.allShipsSunk()}}const i=document.querySelector(".player-turn"),o=document.querySelector(".messages__container"),n=document.querySelector("#reset"),a=document.querySelector("#randomize"),r=document.querySelector("#play"),c=document.querySelector("#standard"),d=document.querySelector("#advanced");function l(t,e){t.textContent="";let s=t.offsetWidth/10;e.forEach(((e,i)=>{e.forEach(((e,o)=>{const n=document.createElement("div");n.style.width=`${s}px`,n.style.height=`${s}px`,n.dataset.row=`${i}`,n.dataset.column=`${o}`,e.ship?(n.draggable=!0,n.dataset.shipId=`${e.ship.id}`,n.classList.add("ship")):n.classList.add("cell"),e.isHit&&(n.className=e.ship?"hit":"miss"),t.appendChild(n)}))}))}function h(t,e){t.textContent="";const s=t.offsetWidth/10;e.forEach(((e,i)=>{e.forEach(((e,o)=>{const n=document.createElement("div");n.classList.add("cell","computer-cell"),n.style.width=`${s}px`,n.style.height=`${s}px`,n.dataset.row=i,n.dataset.column=o,e.isHit&&(n.className=e.ship?"hit":"miss"),t.appendChild(n)}))}))}function u(t){t.classList.add("disable")}function m(){c.classList.add("active")}function p(){d.classList.remove("active")}function g(){n.classList.add("disable")}function f(t){if(t.target.classList.contains("ship")){!function(t,e){const s=R.gameBoard,i=s.getShips().find((e=>e.id===t)),o=i.getPosition(),n=i.getDirection();s.clearShipAndReservedCells(i),i.setDirection("horizontal"===n?"vertical":"horizontal");if(s.canMoveTo(i,e)){s.placeShip(i,e)||s.placeShip(i,o)}else i.setDirection(n),s.placeShip(i,o);s.getShips().forEach((t=>s.reserveCells(t,t.getPosition())))}(t.target.dataset.shipId,[Number(t.target.dataset.row),Number(t.target.dataset.column)])}}function S(){i.textContent="YOUR TURN"===i.textContent?"COMPUTER'S TURN":"YOUR TURN",(R.isLost()||N.isLost())&&(i.textContent="GAME OVER!")}function v(){const t=document.createElement("p");t.classList.add("message"),t.textContent="Welcome to Battleship game. Click Play to get started",o.appendChild(t)}function L(){const t=o.style.backgroundColor;setTimeout((()=>{o.style.backgroundColor="#feee59ff",o.style.transition="background-color 0.5s ease"}),500),setTimeout((()=>{o.style.backgroundColor=t,o.style.transition="background-color 0.5s ease"}),1200)}function C(e){const s=R.gameBoard;if("drop"===e.type){const{shipId:t,newCoordinates:i}=function(t){const e=t.dataTransfer.getData("text/plain"),{row:s,column:i}=t.target.dataset;return{shipId:e,newCoordinates:[Number(s),Number(i)]}}(e),o=s.getShips().find((e=>e.id===t)),n=o.getPosition();s.clearShipAndReservedCells(o);if(s.canMoveTo(o,i)){s.placeShip(o,i)||s.placeShip(o,n)}else s.placeShip(o,n);s.getShips().forEach((t=>s.reserveCells(t,t.getPosition())))}else{s.resetBoard();const e=[5,4,3,3,2],i=e.length,o=["Aircraft Carrier","Battleship","Submarine","Cruiser","Destroyer"];for(let n=0;n<i;n++){let i,a;do{const r=[Math.floor(10*Math.random()),Math.floor(10*Math.random())];i=Math.random()<.5?"horizontal":"vertical";const c=new t(e[n],i,o[n]);a=s.placeShip(c,r)}while(!a)}}}function b(){const e=N.gameBoard,s=["Aircraft Carrier","Battleship","Submarine","Cruiser","Destroyer"];e.resetBoard(),[5,4,3,3,2].forEach(((i,o)=>{let n,a;do{const r=Math.floor(10*Math.random()),c=Math.floor(10*Math.random());n=Math.random()<.5?"horizontal":"vertical";const d=new t(i,n,s[o]);a=e.placeShip(d,[r,c])}while(!a)}))}function E(t,e){const[s,i]=e,o=[];for(let n=-1;n<=1;n++)for(let a=-1;a<=1;a++){const r=s+n,c=i+a;if(r>=0&&r<t.rows&&c>=0&&c<t.columns){const s=[r,c];t.getShipCells().has(`${s}`)&&s.toString()!==e.toString()&&!t.getAllHits().has(`${s}`)&&o.push(s)}}return o}let y="standard",k=!0,w=[];function B(t){y=t}function M(){return y}function q(t){w=t}function x(){return w}const R=new s("human"),N=new s("computer"),O=document.querySelector("#human-board"),A=document.querySelector("#computer-board"),T=document.querySelector("#instructions"),H=document.querySelector("#instructions-modal"),$=document.querySelector("#close-btn"),D=document.querySelector(".computer__levels"),z=document.querySelector("#randomize"),U=document.querySelector("#reset"),P=document.querySelector("#play");document.addEventListener("DOMContentLoaded",(t=>{C(t),l(O,R.gameBoard.board),b(),h(A,N.gameBoard.board),u(A),m(),g(),v(),L()})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&H.close()})),D.addEventListener("click",(t=>{"standard"===t.target.id?(B("standard"),m(),p()):"advanced"===t.target.id&&(B("advanced"),d.classList.add("active"),c.classList.remove("active"))})),A.addEventListener("click",(t=>{const e=[+t.target.dataset.row,+t.target.dataset.column];try{R.makeMove(N.gameBoard,e),h(A,N.gameBoard.board),S(),k&&(!function(){const t=document.createElement("p");t.classList.add("message"),t.textContent="Game on! Computer is playing in Learning mode",o.prepend(t)}(),k=!1),N.gameBoard.getShips().forEach((t=>{if(t.isSunk()&&!t.getSunkNotified()){t.setSunkNotified(!0);const e=document.createElement("p");e.classList.add("sunk","message"),e.textContent=`Computer's ${t.name} has sunk!`,o.prepend(e),document.querySelector(`[data-name="Computer ${t.name}"]`).classList.add("lost")}}));const t=function(t){if(t.getAllHits().size>=100)throw new Error("All squares have been hit");let e;do{e=[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}while(t.getAllHits().has(e.toString()));return e}(R.gameBoard);setTimeout((()=>{const e=M();if("standard"===e)N.makeMove(R.gameBoard,t);else if("advanced"===e){let e=x();if(e.length){const t=e.shift();N.makeMove(R.gameBoard,t)&&(e=E(R.gameBoard,t),q(e))}else{N.makeMove(R.gameBoard,t)&&(e=E(R.gameBoard,t),q(e))}}l(O,R.gameBoard.board),S(),R.gameBoard.getShips().forEach((t=>{if(t.isSunk()&&!t.getSunkNotified()){t.setSunkNotified(!0);const e=document.createElement("p");e.classList.add("sunk","message"),e.textContent=`Your ${t.name} has sunk!`,o.prepend(e),document.querySelector(`[data-name="Human ${t.name}"]`).classList.add("lost")}}));(function(){const t=document.createElement("p");if(t.classList.add("winner","message"),R.isLost()){t.textContent="YOU LOSE. COMPUTER WINS!";const e=document.createElement("p");return e.classList.add("message"),e.textContent="Click Reset to start a new game",o.prepend(e,t),!0}if(N.isLost()){t.textContent="COMPUTER LOST. YOU WON!";const e=document.createElement("p");return e.classList.add("message"),e.textContent="Click Reset to start a new game",o.prepend(e,t),!0}})()&&(u(A),A.querySelectorAll(".computer-cell").forEach((t=>t.classList.remove("hover-effect"))))}),300)}catch(t){!function(t){const e=document.createElement("p");e.classList.add("error"),e.textContent=t.message,o.prepend(e)}(t)}})),O.addEventListener("dragstart",(t=>{t.target.classList.contains("ship")&&function(t){const e=t.target.dataset.shipId;document.querySelectorAll(`[data-ship-id="${e}"]`).forEach((t=>t.classList.add("drag-ship"))),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e)}(t)})),O.addEventListener("dragend",(t=>{t.target.classList.contains("ship")&&function(t){const e=t.target.dataset.shipId;document.querySelectorAll(`[data-ship-id="${e}"]`).forEach((t=>t.classList.remove("drag-ship")))}(t)})),O.addEventListener("dragenter",(t=>{t.target.classList.contains("cell")&&function(t){t.target.classList.add("target-square")}(t)})),O.addEventListener("dragleave",(t=>{t.target.classList.contains("cell")&&function(t){t.target.classList.remove("target-square")}(t)})),O.addEventListener("dragover",(t=>{t.target.classList.contains("cell")&&function(t){t.preventDefault()}(t)})),O.addEventListener("drop",(t=>{t.target.classList.contains("cell")&&(C(t),l(O,R.gameBoard.board))})),O.addEventListener("click",(t=>{f(t),l(O,R.gameBoard.board)})),T.addEventListener("click",(()=>{H.showModal()})),$.addEventListener("click",(()=>{H.close()})),z.addEventListener("click",(t=>{C(t),l(O,R.gameBoard.board)})),P.addEventListener("click",(()=>{O.classList.add("disable"),function(t){t.classList.remove("disable")}(A),function(t){t.querySelectorAll(".computer-cell").forEach((t=>t.classList.add("hover-effect")))}(A),c.classList.add("disable"),d.classList.add("disable"),r.classList.add("disable"),n.classList.remove("disable"),a.classList.add("disable"),i.textContent="YOUR TURN",function(){const t=document.createElement("p");t.classList.add("message"),t.textContent="Legend: Orange = Miss, Red = Hit";const e=document.createElement("p");e.classList.add("message"),e.textContent="Your turn: Click any square on the enemy board",o.prepend(e,t)}()})),U.addEventListener("click",(t=>{C(t),l(O,R.gameBoard.board),O.classList.remove("disable"),b(),h(A,N.gameBoard.board),u(A),c.classList.remove("disable"),d.classList.remove("disable"),m(),p(),r.classList.remove("disable"),a.classList.remove("disable"),g(),B("standard"),i.textContent="",o.innerHTML="",document.querySelectorAll(".ships__item").forEach((t=>{t.classList.remove("lost")})),v(),L()}))})();